// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  userId             String  @id @default(uuid())
  name               String
  email              String  @unique
  phone              String  @unique
  password           String
  role               Role    @default(USER)
  companyName        String?
  businessLogo       String?
  licenseInfo        String?
  licenseNo          String?
  companyDescription String?
  servicesType       String?
  yearFounded        String?
  numberOfEmployee   String?
  website            String?
  businessAddress    String?
  isNotification     Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Rls

  jobs             Job[]
  bids             Bid[]
  payments         Payment[]
  sentMessages     Message[]      @relation("SentMessages")
  receivedMessages Message[]      @relation("ReceivedMessages")
  nitifications    Nitification[]

  @@map("users")
}

model Job {
  jobId  String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [userId], onDelete: Cascade)

  // Job details
  jobTitle                             String
  jobType                              String
  projectDescription                   String
  technicalDescriptionAndCertification String
  elevatorType                         String
  numberOfElevator                     Int       @default(0)
  capasity                             String
  speed                                String
  address                              String
  streetAddress                        String
  city                                 String
  zipCode                              String
  photo                                String
  documents                            String
  estimitedBudget                      String
  jobStatus                            JobStatus @default(OPEN)

  // Relations
  bids    Bid[]
  payment Payment? @relation(fields: [paymentId], references: [paymentId])

  paymentId String? @unique

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Bid {
  bidId  String  @id @default(uuid())
  userId String
  user   User    @relation(fields: [userId], references: [userId], onDelete: Cascade)
  jobId  String?
  job    Job?    @relation(fields: [jobId], references: [jobId])

  bidAmount          String
  completionTimeline String
  brefProposal       String
  status             BidStatus @default(PENDING_REVIEW)
}

model Message {
  messageId String @id @default(ulid())
  text      String

  // Sender
  senderId String
  sender   User   @relation("SentMessages", fields: [senderId], references: [userId], onDelete: Cascade)

  // Receiver / Target
  receiverId String
  receiver   User   @relation("ReceivedMessages", fields: [receiverId], references: [userId], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Payment {
  paymentId String @id @default(uuid())
  amount    Int
  userId    String
  user      User   @relation(fields: [userId], references: [userId], onDelete: Cascade)
  job       Job?   @relation
}

model Nitification {
  notificationId String   @id @default(uuid())
  userId         String
  user           User     @relation(fields: [userId], references: [userId], onDelete: Cascade)
  title          String
  description    String
  logo           String
  isSeen         Boolean  @default(false)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

enum Role {
  USER
  ELEVATOR
  ADMIN
  SUPER_ADMIN
}

enum JobTypes {
  NewInstallation
  Modernization
  MaintenanceContract
  Repair
  Inspection
  Consultation
}

enum JobStatus {
  OPEN
  ACCEPTED
  DECLINED
  PENDING_REVIEW
  INPROGRESS
  COMPLITE
}

enum BidStatus {
  ACCEPTED
  DECLINED
  PENDING_REVIEW
}
