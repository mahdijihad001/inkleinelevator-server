// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  userId             String                @id @default(uuid())
  name               String
  email              String                @unique
  phone              String                @unique
  password           String
  role               Role                  @default(USER)
  companyName        String?
  businessLogo       String?
  profile            String?
  licenseInfo        String?
  licenseNo          String?
  companyDescription String?
  servicesType       String?
  yearFounded        String?
  numberOfEmployee   String?
  website            String?
  otp                String?
  businessAddress    String?
  refreshToken       String?
  stripeAccountId    String?
  isNotification     Boolean               @default(true)
  verifidStatus      elevatorVerifidStatus @default(REQUEST)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  jobs             Job[]
  bids             Bid[]
  payments         Payment[]
  sentMessages     Message[]      @relation("SentMessages")
  receivedMessages Message[]      @relation("ReceivedMessages")
  nitifications    Nitification[]

  reviewsGiven     Review[]         @relation("ReviewsGiven") // Reviews this user gave
  reviewsReceived  Review[]         @relation("ReviewsReceived") // Reviews this user received
  recentActivities RecentActivity[]

  @@map("users")
}

model Job {
  jobId  String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [userId], onDelete: Cascade)

  // Job details
  jobTitle                            String
  jobType                             String
  projectDescription                  String
  technicalRequermentAndCertification String[]
  elevatorType                        String
  numberOfElevator                    Int              @default(0)
  capasity                            String
  speed                               String
  address                             String
  streetAddress                       String
  city                                String
  zipCode                             String
  photo                               String[]
  documents                           String[]
  estimitedBudget                     String
  acceptedConstructorId               String?
  acceptedConstructorBidId            String?
  jobStatus                           JobStatus        @default(OPEN)
  paymentStatus                       JobPaymentStatus @default(UNPAID)
  // Relations
  bids                                Bid[]
  payment                             Payment[]

  reviews Review[] @relation("JobReviews")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Bid {
  bidId  String  @id @default(uuid())
  userId String
  user   User    @relation(fields: [userId], references: [userId], onDelete: Cascade)
  jobId  String?
  job    Job?    @relation(fields: [jobId], references: [jobId])

  bidAmount          Int       @default(0)
  timeline           Int       @default(0)
  completionTimeline String?
  brefProposal       String
  status             BidStatus @default(PENDING_REVIEW)
}

model Message {
  messageId String @id @default(ulid())
  text      String

  // Sender
  senderId String
  sender   User   @relation("SentMessages", fields: [senderId], references: [userId], onDelete: Cascade)

  // Receiver / Target
  receiverId String
  receiver   User   @relation("ReceivedMessages", fields: [receiverId], references: [userId], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Payment {
  paymentId       String               @id @default(uuid())
  amount          Int
  userId          String
  releaseStatus   PaymentReleaseStatus @default(REVIEW)
  status          paymentStatus        @default(UNPAID)
  stripePaymentId String
  jobId           String
  bidId           String
  user            User                 @relation(fields: [userId], references: [userId], onDelete: Cascade)
  job             Job                  @relation(fields: [jobId], references: [jobId], onDelete: Cascade)
  createdAt       DateTime             @default(now())
}

model ContactMessage {
  id          String  @id @default(uuid())
  firstName   String
  lastName    String
  email       String
  phoneNumber String?
  userType    String?
  subject     String
  message     String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("contact_messages")
}

model Nitification {
  notificationId String   @id @default(uuid())
  userId         String
  user           User     @relation(fields: [userId], references: [userId], onDelete: Cascade)
  title          String
  description    String
  logo           String
  isSeen         Boolean  @default(false)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Review {
  reviewId String @id @default(uuid())

  reviewerId String
  revieweeId String
  jobId      String

  reviewer User @relation("ReviewsGiven", fields: [reviewerId], references: [userId], onDelete: Cascade)
  reviewee User @relation("ReviewsReceived", fields: [revieweeId], references: [userId], onDelete: Cascade)
  job      Job  @relation("JobReviews", fields: [jobId], references: [jobId], onDelete: Cascade)

  rating  Int
  comment String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("reviews")
}

model RecentActivity {
  recentActivityId String   @id @default(uuid())
  userId           String
  user             User     @relation(fields: [userId], references: [userId], onDelete: Cascade)
  description      String
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

enum Role {
  USER
  ELEVATOR
  ADMIN
  SUPER_ADMIN
}

enum JobPaymentStatus {
  PAID
  UNPAID
}

enum JobTypes {
  NewInstallation
  Modernization
  MaintenanceContract
  Repair
  Inspection
  Consultation
}

model HeroSection {
  id           String  @id @default(uuid())
  heroKay      String  @unique
  tagline      String
  image        String?
  mainTitle    String
  subtitle     String
  primaryCTA   String
  secondaryCTA String
}

model AboutSection {
  id               String @id @default(uuid())
  aboutKey         String @unique
  sectionLabel     String
  title            String
  description      String
  ctaButtonText    String
  StatisticsNumber Int
  StatisticsLable  String
}

model HowItWorksSection {
  id            String           @id @default(uuid())
  howToWorksKey String           @unique
  sectionLabel  String
  sectionTitle  String
  steps         HowItWorksStep[]
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
}

model HowItWorksStep {
  id          String @id @default(uuid())
  title       String
  description String

  sectionId String
  section   HowItWorksSection @relation(fields: [sectionId], references: [id], onDelete: Cascade)
}

model HowItsFor {
  sectionId String @id @default(uuid())

  how_its_for_key String  @unique
  label           String
  title           String
  subtitle        String?

  audiences HowItsForCard[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model HowItsForCard {
  audienceId String @id @default(uuid())

  sectionId String
  section   HowItsFor @relation(fields: [sectionId], references: [sectionId], onDelete: Cascade)

  type         AudienceType
  cardTitle    String
  cardSubtitle String?

  bulletText String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Faq {
  qaCardId String @id @default(uuid())

  question String
  ans      String
}

enum AudienceType {
  JOB_REQUESTER
  CONTRACTOR
}

enum JobStatus {
  OPEN
  ACCEPTED
  DECLINED
  PENDING_REVIEW
  INPROGRESS
  COMPLITE
}

enum BidStatus {
  ACCEPTED
  DECLINED
  PENDING_REVIEW
}

enum PaymentReleaseStatus {
  REVIEW
  RELESE
  REFUND
}

enum elevatorVerifidStatus {
  VERIFID
  SUSPEND
  DECLINT
  REQUEST
}

enum paymentStatus {
  PAID
  UNPAID
  CANCEL
  REFUND
}
